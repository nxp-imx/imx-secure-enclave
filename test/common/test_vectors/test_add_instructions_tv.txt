
Description Note about the steps/format needed to be followed while
adding Tests in test vector file.

NOTE: The test vector filename with full PATH needs to be provided when
running the ele_hsm_test application.
Format: ele_hsm_test <tv_file_path>

If the <tv_file_path> not provided, then default tv file is used to run tests.

The file contains tests with the tags and follow the format described here.

NOTE: Currently Supports test vectors for: KGEN, CIPHER, MAC, Signature
Generation & Signature Verification


The test file is read line by line till EOF, to identify and use certain
lines/values. The lines which does not contain Recognized tags, get skipped.

The various tags used for representing start and stop of
services/operations/actions, parameter names etc. currently being used
are mentioned in below. Later more may get added.


Some Limitations about the format:

-	ALl Recognized Tags like TESTS_START, TESTS_END, TEST_KGEN_*, TEST_KGEN_END,
	TEST_CIPHER_*, TEST_CIPHER_END, TEST_MAC_*, TEST_MAC_END, TEST_SIGN_VERIFY_*,
	TEST_SIGN_VERIFY_END, KEY_TV_ID, PERMITTED_ALGO, KEY_USAGE, etc. needs
	to start from very beginning of their line as these tags get read from
	very start of the line.

-	Only Spaces (Not tabs) need to be used for PARAM_NAME  'space' PARAM_VALUE
	key value pair.

-	OPEN_KEY_MGMT_SRV, CLOSE_KEY_MGMT_SRV, Buffer Inputs expect the input
	value in the just immediate next line of these/their tags.



------------------------------------------------------------------------
FORMAT for Test start of tests in test vector file:
------------------------------------------------------------------------

TESTS_START


-------------------------------------------------------------------------
FORMAT for ending the Tests started with TESTS_START:
-------------------------------------------------------------------------

TESTS_END


-------------------------------------------------------------------------
FORMAT for Opening Key Management service:
-------------------------------------------------------------------------

OPEN_KEY_MGMT_SRV
KEY_MGMT_TV_ID (only Value in the next line of the OPEN_KEY_MGMT_SRV tag)

E.g.

OPEN_KEY_MGMT_SRV
1234           #KEY_MGMT_TV_ID



-------------------------------------------------------------------------
FORMAT for Closing Key Management service opened with OPEN_KEY_MGMT_SRV:
-------------------------------------------------------------------------

CLOSE_KEY_MGMT_SRV
KEY_MGMT_TV_ID (only Value in the next line of the CLOSE_KEY_MGMT_SRV tag)

E.g.

CLOSE_KEY_MGMT_SRV
1234           #KEY_MGMT_TV_ID



------------------------------------------------------------------------
Tests of different test types/categories like KGEN (Key Generation),
CIPHER etc. can be added with following FORMAT:
------------------------------------------------------------------------

TEST_<Test_Type>_<PSA/NON_PSA>_<m><n>   #TEST_<Test_Type> marks Start of Test
The represents the start of a ELE HSM API test

PARAM_NAME   <spaces>   PARAM_VALUE     #Comments (If any)

NOTE: Space ' ', are important and tabs cannot be used, as Space is tokenizing
character for getting parameter name and its value

TEST_<Test_Type>_END                    #marks the end of test


'm' representing test type
0 - KGEN
1 - CIPHER
2 - MAC
3 - SIGN_VERIFY

'n' representing serial no of test of particular test type/category
1, 2, 3,...so on

PSA/NON_PSA in Test Name is for checking whether to run test case or skip
if not compatible with application compliance

E.g.

# KGEN Test
TEST_KGEN_PSA_001          #TEST_KGEN in beginning marks KGEN test start
PARAM_NAME PARAM VALUE     #Key-Value pair of Param Names and Values
PARAM_NAME PARAM VALUE
...
TEST_KGEN_END              #End



------------------------------------------------------------------------
FORMAT for Test Parameter which is a Input Buffer:
------------------------------------------------------------------------

INPUT_SIZE         DEC       #Input Size for Buffer
INPUT_DATA         DEC       #INPUT_DATA DEC value is the same INPUT_SIZE
Input Buffer with uint8_t (0x01, 0x02,....) separated with ', '

NOTE: The buffer needs to be provided from the immediate next line just
after INPUT_DATA tag is encountered.

INPUT_DATA/INPUT_SIZE are just placeholders and actual param names has to be
used according to tests

NOTE: INPUT_SIZE must be given before INPUT_DATA to allocate memory



------------------------------------------------------------------------
FORMAT and PARAMETERS for KGEN Tests:
------------------------------------------------------------------------

#Positive/Negative Case - Test Description (Optional line)
TEST_KGEN_<PSA/NON_PSA>_0<n>   #Marks Start of this one particular KGEN test

#PARAM_NAME       #PARAM_VALUE    #this line is not part of test

KEY_MGMT_TV_ID    DEC (uint32_t)  #Key Management ID to get Key Management hdl
KEY_TV_ID         DEC (uint32_t)  #Key TV ID to identify and use the key later
KEY_ID            HEX (uint32_t)  #Key ID is to be set to 0 in case of Volatile
OUT_SIZE          DEC (uint16_t)  #Output Public Key Size, 0 bytes for Symmetric Key
KEY_TYPE          HEX (uint16_t)  #Value of HSM Key Type to be used
BIT_KEY_SZ        HEX (uint16_t)  #Key Size bits
FLAGS             HEX (uint8_t)   #Flags for operation
KEY_GROUP         DEC (uint16_t)  #Value of Key Group out of range 0-1023
KEY_LIFETIME      HEX (uint32_t)  #Value of Key Lifetime
KEY_USAGE         HEX (uint32_t)  #Calculated combined value of Key Usages needed
PERMITTED_ALGO    HEX (uint32_t)  #Value of Permitted Algo
EXPECTED_HSM_RESP HEX (uint8_t)   #Value of Expected HSM Response

TEST_KGEN_END                     #Marks the End of this one particular KGEN test


#DEC - DECimal value, HEX - HEXadecimal value (0x...)

NOTE: The Keys are saved so that it can used later through KEY_TV_ID by tests
(such as CIPHER, MAC) which may need the same key for their operations.



-------------------------------------------------------------------------
FORMAT and PARAMETERS for CIPHER Tests:
-------------------------------------------------------------------------

#Positive/Negative Case - Test Description (Optional line)
TEST_CIPHER_<PSA/NON_PSA>_1<n>

KEY_MGMT_TV_ID    DEC (uint32_t)  #Key Management TV ID to get Key Management hdl
KEY_TV_ID         DEC (uint32_t)  #Key TV ID from KGEN Tests to use the key
IV_SIZE           DEC (uint16_t)  #IV Size provided before IV data

IV_DATA           DEC (again IV_SIZE) #Next line have ', ' separated values
0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07,
0x08, 0x09, 0x0A, 0x0B, 0x0C, 0x0D, 0x0E, 0x0F

#(Example of Input buffer format is given as above, buffer of 'uint8_t' values)

INPUT_SIZE        DEC (uint32_t)  #Plaintext/Input size to allocate memory

INPUT_DATA        DEC (again INPUT_SIZE) #Next line have ', ' separated values
0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07,
0x08, 0x09, 0x0A, 0x0B, 0x0C, 0x0D, 0x0E, 0x0F,
0x10, 0x11, 0x12, 0x13, 0x14, 0x15, 0x16, 0x17,
0x18, 0x19, 0x1A, 0x1B, 0x1C, 0x1D, 0x1E, 0x1F

#( buffer of 'uint8_t' values)

OUTPUT_SIZE       DEC (uint32_t)  #Ciphertext/Output size
CIPHER_ALGO       HEX (uint32_t)  #Value of Cipher Algorithm to be used
EXPECTED_HSM_RESP HEX (uint8_t)   #Expected HSM Response

TEST_CIPHER_END



-------------------------------------------------------------------------
FORMAT and PARAMETERS for MAC Tests:
-------------------------------------------------------------------------

#Positive/Negative Case - Test Description (Optional line)
TEST_MAC_<PSA/NON_PSA>_2<n>

KEY_MGMT_TV_ID    DEC (uint32_t)  # Key Management TV ID to get Key Management hdl
KEY_TV_ID         DEC (uint32_t)  # Key TV ID from KGEN Tests to use the key
MAC_ALGO          HEX (uint32_t)  # MAC algorithm to be used
PAYLOAD_SIZE      DEC (uint32_t)  # Payload size to allocate memory

PAYLOAD_DATA      DEC (uint32_t)  # Payload data-Payload size for input
0xB2, 0xE1, 0x4C, 0x5C, 0x79, 0xC6, 0xDF, 0x5B,
0x85, 0xF4, 0xFE, 0x7E, 0xD8, 0xDB, 0x7A, 0x26,
0x2B, 0x9D, 0xA7, 0xE0, 0x7C, 0xCB, 0x0E, 0xA9,
0xF4, 0x74, 0x7B, 0x8C, 0xCD, 0xA8, 0xA4, 0xF3

#(Example of Input buffer format is given as above, 'uint8_t' HEX values)

MAC_SIZE     DEC (uint16_t) # MAC buffer size, allocates memory for MAC data

# Expected output MAC size is valid for case, when MAC API MAC Generation Resp
# (also Expected Resp) is HSM_NO_ERROR, HSM_OUT_TOO_SMALL or HSM_GENERAL_ERROR
EXP_MAC_SIZE      DEC (uint16_t)  # Expected output MAC size

# Expected MAC Verification status, valid if Verification op flag is set.
EXP_VERIFICATION_STATUS HEX (uint32_t) # Expected MAC API verification status

EXP_MAC_GEN_HSM_RESP    HEX (uint8_t)  # Expected HSM Resp for MAC Generation
EXP_MAC_VERIFY_HSM_RESP HEX (uint8_t)  # Expected HSM Resp for MAC Verification

TEST_MAC_END



------------------------------------------------------------------------------
FORMAT and PARAMETERS for Signature Generation & Signature Verification Tests:
------------------------------------------------------------------------------

#Positive/Negative Case:
#Test Description (Optional line)

TEST_SIGN_VERIFY_<PSA/NON_PSA>_3<n>

KEY_TV_ID         DEC (uint32_t)  # Key TV ID from KGEN Tests to use the key
MESSAGE_SIZE      DEC (uint32_t)  # Message size of input message

MESSAGE           DEC (uint32_t)  # Message-Message size for input buffer
0xB2, 0xE1, 0x4C, 0x5C, 0x79, 0xC6, 0xDF, 0x5B,
0x85, 0xF4, 0xFE, 0x7E, 0xD8, 0xDB, 0x7A, 0x26,
0x2B, 0x9D, 0xA7, 0xE0, 0x7C, 0xCB, 0x0E, 0xA9,
0xF4, 0x74, 0x7B, 0x8C, 0xCD, 0xA8, 0xA4, 0xF3

#(Example of Input buffer format is given as above, 'uint8_t' HEX values)

SIGNATURE_SIZE    DEC (uint16_t)   # Signature buffer size
SCHEME_ID         HEX (uint32_t)   # Scheme to be used for the operation
SIGN_GEN_FLAGS    HEX (uint8_t)    # Signature Generation flags
SIGN_VERIFY_FLAGS HEX (uint8_t)    # Signature Verification flags
PKEY_TYPE         HEX (uint32_t    # Public Key Type
KEY_SIZE          DEC (uint16_t)   # Input public key size in bytes
BIT_KEY_SZ        DEC (uint16_t)   # Key security size in bits

# Expected output Signature size is valid for case, when Signature Generation
# API Resp (also Expected Resp) is HSM_NO_ERROR, HSM_OUT_TOO_SMALL
# or HSM_GENERAL_ERROR
EXP_SIGNATURE_SIZE      DEC (uint16_t) # Expected output signature size

# Expected Signature Verification status
EXP_VERIFICATION_STATUS HEX (uint32_t) # Expected Signature Verification status

EXP_SIGN_GEN_RSP    HEX (uint8_t)  # Expected Signature Generation HSM Resp
EXP_SIGN_VERIFY_RSP HEX (uint8_t)  # Expected Signature Verification HSM Resp

TEST_SIGN_VERIFY_END



-------------------------------------------------------------------------
Example of a Complete Test:
-------------------------------------------------------------------------

#TestVector Tests Example


TESTS_START


OPEN_KEY_MGMT_SRV
1234     #Key Management ID, KEY_MGMT_TV_ID to be used by tests


#Key Generation test

#Positive Case
TEST_KGEN_PSA_001

KEY_MGMT_TV_ID    1234       # Key Management TV ID to get Key Mgmt hdl
KEY_TV_ID         1          # Key TV ID to use the key later
KEY_ID            0x0        # Key ID set to 0 for Volatile
OUT_SIZE          0          # Symmetric Key. So, Public Key Out Size 0
KEY_TYPE          0x2400     # HSM_KEY_TYPE_AES
BIT_KEY_SZ        256        # HSM_KEY_SIZE_AES_256
FLAGS             0          #
KEY_GROUP         1          # Key Group b/w range 0-1023
KEY_LIFETIME      0x00000000 # HSM_SE_INTERN_STORAGE_VOLATILE
KEY_USAGE         0x00000300 # HSM_KEY_USAGE_ENCRYPT | HSM_KEY_USAGE_DECRYPT
PERMITTED_ALGO    0x84C0FF00 # PERMITTED_ALGO_ALL_CIPHER
EXPECTED_HSM_RESP 0x00       # HSM_NO_ERROR

TEST_KGEN_END


#Test for Generating Key with KEY_TV_ID 101 to be used by Cipher Test

#Positive Case - Cipher Test KGEN
TEST_KGEN_PSA_101

KEY_MGMT_TV_ID     1234        # Key Management ID
KEY_TV_ID          101         # Key TV ID to use the key later
KEY_ID             0x0         # Key ID set to 0 for Volatile
OUT_SIZE           0           # Symmetric Key. So, Public Key Out Size 0
KEY_TYPE           0x2400      # HSM_KEY_TYPE_AES
BIT_KEY_SZ         256         # HSM_KEY_SIZE_AES_256
FLAGS              0           #
KEY_GROUP          1           # Key Group b/w 0-1023
KEY_LIFETIME       0x00000000  # HSM_SE_INTERN_STORAGE_VOLATILE
KEY_USAGE          0x00000300  # HSM_KEY_USAGE_ENCRYPT | HSM_KEY_USAGE_DECRYPT
PERMITTED_ALGO     0x04404000  # PERMITTED_ALGO_CBC_NO_PADDING
EXPECTED_HSM_RESP  0x00        # HSM_NO_ERROR

TEST_KGEN_END



#CIPHER test using the key with KEY_TV_ID 101

#Positive Case
TEST_CIPHER_PSA_101

KEY_MGMT_TV_ID    1234        # Key Management TV ID
KEY_TV_ID         101         # Key TV ID from KGEN Tests to use the key
IV_SIZE           16          # IV Size provided before IV data

IV_DATA           16          # IV data-IV size take input from next line
0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07,
0x08, 0x09, 0x0A, 0x0B, 0x0C, 0x0D, 0x0E, 0x0F

INPUT_SIZE        32          # Plaintext size to allocate memory

INPUT_DATA        32          # Plaintext size to take input from next line
0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07,
0x08, 0x09, 0x0A, 0x0B, 0x0C, 0x0D, 0x0E, 0x0F,
0x10, 0x11, 0x12, 0x13, 0x14, 0x15, 0x16, 0x17,
0x18, 0x19, 0x1A, 0x1B, 0x1C, 0x1D, 0x1E, 0x1F

OUTPUT_SIZE       32          # Ciphertext/output size
CIPHER_ALGO       0x04404000  # HSM_CIPHER_ONE_GO_ALGO_CBC
EXPECTED_HSM_RESP 0x00        # HSM_NO_ERROR

TEST_CIPHER_END



#Test for Generating Key with KEY_TV_ID 201 to be used by MAC test


#Positive Case
TEST_KGEN_PSA_201

KEY_MGMT_TV_ID    1234       # Key Management ID
KEY_TV_ID         201        # Key TV ID to use the key later
KEY_ID            0x0        # Key ID 0 for Volatile Key
OUT_SIZE          0          # Symmetric Key. So, Public Key Out Size 0
KEY_TYPE          0x2400     # HSM_KEY_TYPE_AES
BIT_KEY_SZ        256        # HSM_KEY_SIZE_AES_256
FLAGS             0          #
KEY_GROUP         3          # Key Group b/w 0-1023
KEY_LIFETIME      0x00000000 # HSM_SE_INTERN_STORAGE_VOLATILE
KEY_USAGE         0x00000C00 # HSM_KEY_USAGE_SIGN_MSG | HSM_KEY_USAGE_VERIFY_MSG
PERMITTED_ALGO    0x03C00200 # PERMITTED_ALGO_CMAC
EXPECTED_HSM_RESP 0x00       # HSM_NO_ERROR

TEST_KGEN_END



#MAC test using the key with KEY_TV_ID 201

#Positive Case:
#Test MAC operation with CMAC algo using saved AES 256 Key permitted for CMAC

TEST_MAC_PSA_201

KEY_MGMT_TV_ID    1234       # Key Management TV ID
KEY_TV_ID         201        # Key TV ID from KGEN Tests to use the key
MAC_ALGO          0x03C00200 # PERMITTED_ALGO_CMAC
PAYLOAD_SIZE      32         # Payload Size provided before Payload data

PAYLOAD_DATA      32         # Payload data-Payload size, input from next line
0xB2, 0xE1, 0x4C, 0x5C, 0x79, 0xC6, 0xDF, 0x5B,
0x85, 0xF4, 0xFE, 0x7E, 0xD8, 0xDB, 0x7A, 0x26,
0x2B, 0x9D, 0xA7, 0xE0, 0x7C, 0xCB, 0x0E, 0xA9,
0xF4, 0x74, 0x7B, 0x8C, 0xCD, 0xA8, 0xA4, 0xF3

MAC_SIZE          16         # MAC buffer size
EXP_MAC_SIZE      16         # Expected MAC size
EXP_VERIFICATION_STATUS 0x6C1AA1C6u # HSM_MAC_VERIFICATION_STATUS_SUCCESS
EXP_MAC_GEN_HSM_RESP    0x00 # HSM_NO_ERROR
EXP_MAC_VERIFY_HSM_RESP 0x00 # HSM_NO_ERROR

TEST_MAC_END



CLOSE_KEY_MGMT_SRV
1234     #KEY_MGMT_TV_ID


TESTS_END




#Test for Generating Key with KEY_TV_ID 301 to be used by Signature Generation
#& Signature Verification test



#Positive Case:
TEST_KGEN_PSA_301

KEY_MGMT_TV_ID    1234       # Key Management ID
KEY_TV_ID         301        # Key TV ID to use the key later
KEY_ID            0x0        # Key ID 0 for Volatile Key
OUT_SIZE          56         # Public Key Out Size
KEY_TYPE          0x7112     # HSM_KEY_TYPE_ECC_NIST
BIT_KEY_SZ        224        # HSM_KEY_SIZE_ECC_NIST_224
FLAGS             0          #
KEY_GROUP         3          # Key Group b/w 0-1023
KEY_LIFETIME      0x00000000 # HSM_SE_INTERN_STORAGE_VOLATILE
KEY_USAGE         0x00003000 # HSM_KEY_USAGE_SIGN_HASH | HSM_KEY_USAGE_VERIFY_HASH
PERMITTED_ALGO    0x06000608 # PERMITTED_ALGO_ECDSA_SHA224
EXPECTED_HSM_RESP 0x00       # HSM_NO_ERROR

TEST_KGEN_END



#Signature Generation & Signature Verification test using key KEY_TV_ID 301

#Positive Case:
#Test Signature Generation & Verification operation with ECC NIST 224 key,
#and ECDSA SHA224 algorithm
TEST_SIGN_VERIFY_PSA_301

KEY_TV_ID         301        # Key TV ID from KGEN Tests to use the key
MESSAGE_SIZE      28         # Message Size provided before Payload data

MESSAGE           28         # Message-Message size, input from next line
0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07,
0x08, 0x09, 0x0A, 0x0B, 0x0C, 0x0D, 0x0E, 0x0F,
0x10, 0x11, 0x12, 0x13, 0x14, 0x15, 0x16, 0x17,
0x18, 0x19, 0x1A, 0x1B,

SIGNATURE_SIZE    56         # Signature size
SCHEME_ID         0x06000608 # HSM_SIGNATURE_SCHEME_ECDSA_SHA224
SIGN_GEN_FLAGS    0x0        # HSM_OP_GENERATE_SIGN_FLAGS_INPUT_DIGEST
SIGN_VERIFY_FLAGS 0x0        # HSM_OP_VERIFY_SIGN_FLAGS_INPUT_DIGEST
PKEY_TYPE         0x4112     # HSM_PUBKEY_TYPE_ECC_NIST
KEY_SIZE          56         # Public Key Byte Size
BIT_KEY_SZ        224        # HSM_KEY_SIZE_ECC_NIST_224
EXP_SIGNATURE_SIZE 56        # Expected Signature Size in API Resp
EXP_VERIFICATION_STATUS 0x5A3CC3A5 # HSM_VERIFICATION_STATUS_SUCCESS
EXP_SIGN_GEN_RSP  0x0        # HSM_NO_ERROR
EXP_SIGN_VERIFY_RSP 0x0      # HSM_NO_ERROR

TEST_SIGN_VERIFY_END


-------------------------------------------------------------------------

